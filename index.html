<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3 Dart Calculator</title>
<style>
:root {
  --bg: #0b0b0c;
  --card: #121215;
  --text: #fff;
  --muted: #9aa0a6;
  --btn: #1c1c1f;
  --btn-hover: #2a2a2e;
  --accent: #0a84ff;
  --slot-bg: #0f0f10;
}
[data-theme="light"] {
  --bg: #f2f2f7;
  --card: #ffffff;
  --text: #000;
  --muted: #555;
  --btn: #e5e5ea;
  --btn-hover: #d0d0d7;
  --accent: #007aff;
  --slot-bg: #f2f2f7;
}
html,body {
  height:100%;margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);color:var(--text);
  transition:background .3s,color .3s;
}
.wrap {
  max-width:420px;margin:0 auto;padding:20px;
  display:flex;flex-direction:column;gap:14px;min-height:100vh;box-sizing:border-box;
}
header {
  display:flex;align-items:center;justify-content:center;position:relative;
}
h1 {margin:0;font-size:20px;}
.theme-toggle {
  position:absolute;right:0;top:0;background:none;border:none;
  font-size:22px;color:var(--muted);cursor:pointer;transition:transform .2s;
}
.theme-toggle:active{transform:scale(0.9);}
p.desc {margin:4px 0 18px;text-align:center;color:var(--muted);font-size:13px;}

.turn-card {
  background:var(--card);border-radius:14px;padding:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.4);transition:background .3s;
}
.slots {display:flex;gap:8px;justify-content:space-between;margin-bottom:8px;}
.slot {
  flex:1;background:var(--slot-bg);border-radius:10px;padding:10px;text-align:center;
  min-height:66px;display:flex;flex-direction:column;justify-content:center;align-items:center;
  box-shadow:inset 0 -2px 6px rgba(0,0,0,0.3);transition:background .3s;
}
.slot .label {font-size:12px;color:var(--muted);margin-bottom:6px;}
.slot .value {font-size:18px;font-weight:600;}
.slot .sub {font-size:12px;color:var(--muted);margin-top:4px;}
.total-row {display:flex;justify-content:space-between;align-items:center;margin-top:8px;}
.total-row .tot-label {color:var(--muted);font-size:13px;}
.total-row .tot-val {font-size:20px;font-weight:700;}
.controls {display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px;}
.control-btn {
  padding:10px 12px;border-radius:10px;background:var(--btn);
  border:none;color:var(--text);font-size:15px;min-width:96px;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);cursor:pointer;
  transition:background .2s,transform .1s;
}
.control-btn:active{transform:scale(.98);}
.control-btn:hover{background:var(--btn-hover);}
.mutators {display:flex;gap:8px;justify-content:center;margin-bottom:10px;}
.mutator {
  padding:10px 12px;border-radius:10px;background:transparent;border:1px solid #222;
  color:var(--muted);min-width:64px;text-align:center;font-weight:600;cursor:pointer;
  transition:background .2s,color .2s;
}
[data-theme="light"] .mutator{border-color:#ccc;}
.mutator.active {
  background:var(--accent);color:#fff;border-color:transparent;
  box-shadow:0 6px 14px rgba(10,132,255,0.15);
}
.grid {display:grid;grid-template-columns:repeat(5,1fr);gap:8px;}
.cell {
  background:var(--btn);padding:12px;border-radius:10px;text-align:center;
  font-weight:700;font-size:16px;cursor:pointer;user-select:none;
  transition:background .2s,transform .1s;
}
.cell:active{transform:scale(.97);}
.cell:hover{background:var(--btn-hover);}
footer {margin-top:auto;text-align:center;color:var(--muted);font-size:12px;padding-bottom:12px;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ðŸŽ¯ 3-Dart Calculator</h1>
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle light/dark">ðŸŒ—</button>
  </header>
  <p class="desc">Tap Double or Treble if needed, then a number (25/BULL/Miss). Slots fill leftâ†’right.</p>

  <section class="turn-card" aria-label="Current turn">
    <div class="slots">
      <div class="slot"><div class="label">Dart 1</div><div class="value" id="d1">â€”</div><div class="sub" id="s1"></div></div>
      <div class="slot"><div class="label">Dart 2</div><div class="value" id="d2">â€”</div><div class="sub" id="s2"></div></div>
      <div class="slot"><div class="label">Dart 3</div><div class="value" id="d3">â€”</div><div class="sub" id="s3"></div></div>
    </div>
    <div class="total-row"><div class="tot-label">Turn Total</div><div class="tot-val" id="total">0</div></div>

    <div class="mutators">
      <button class="mutator" data-mult="D">D</button>
      <button class="mutator" data-mult="T">T</button>
      <button class="mutator" data-mult="M">Miss</button>
    </div>

    <div class="grid">
      <!-- 20â€“16 -->
      <button class="cell">20</button><button class="cell">19</button><button class="cell">18</button><button class="cell">17</button><button class="cell">16</button>
      <!-- 15â€“11 -->
      <button class="cell">15</button><button class="cell">14</button><button class="cell">13</button><button class="cell">12</button><button class="cell">11</button>
      <!-- 10â€“6 -->
      <button class="cell">10</button><button class="cell">9</button><button class="cell">8</button><button class="cell">7</button><button class="cell">6</button>
      <!-- 5â€“1 -->
      <button class="cell">5</button><button class="cell">4</button><button class="cell">3</button><button class="cell">2</button><button class="cell">1</button>
      <!-- specials -->
      <button class="cell">25</button><button class="cell">BULL</button><button class="cell">MISS</button><button class="cell" id="backspace">âŒ«</button><button class="cell" disabled></button>
    </div>

    <div class="controls" style="margin-top:12px;">
      <button class="control-btn" id="calcBtn">Calculate</button>
      <button class="control-btn" id="clearBtn">Clear Turn</button>
      <button class="control-btn" id="amendBtn">Amend</button>
    </div>
  </section>

  <footer>Tap numbers to fill Dart 1 â†’ Dart 3. ðŸŒ— toggles light/dark theme.</footer>
</div>

<script>
let multiplier = null; // D, T, M or null = single
let darts = [null, null, null];
let lastSaved = null;

const dEls = [document.getElementById('d1'), document.getElementById('d2'), document.getElementById('d3')];
const sEls = [document.getElementById('s1'), document.getElementById('s2'), document.getElementById('s3')];
const totalEl = document.getElementById('total');

// Mutator toggle logic
const mutators = document.querySelectorAll('.mutator');
mutators.forEach(btn => {
  btn.addEventListener('click', () => {
    if (btn.classList.contains('active')) {
      btn.classList.remove('active');
      multiplier = null;
    } else {
      mutators.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      multiplier = btn.dataset.mult;
    }
  });
});

function makeEntry(val) {
  if (val === 'MISS' || multiplier === 'M') return { label: 'Miss', score: 0 };
  if (val === 'BULL') return { label: 'Bullseye', score: 50 };
  if (val === '25') return { label: '25', score: 25 };
  const n = parseInt(val);
  if (isNaN(n)) return null;
  if (multiplier === 'D') return { label: `D${n}`, score: 2 * n };
  if (multiplier === 'T') return { label: `T${n}`, score: 3 * n };
  return { label: `${n}`, score: n };
}

function fillNext(entry) {
  const idx = darts.findIndex(x => x === null);
  if (idx === -1) return;
  darts[idx] = entry;
  render();
}

function backspace() {
  for (let i = 2; i >= 0; i--) {
    if (darts[i]) {
      darts[i] = null;
      render();
      return;
    }
  }
}

function calculate() {
  lastSaved = JSON.stringify(darts);
  render();
}

function amend() {
  if (lastSaved) {
    darts = JSON.parse(lastSaved);
    render();
  }
}

function clearTurn() {
  darts = [null, null, null];
  render();
}

function render() {
  let total = 0;
  for (let i = 0; i < 3; i++) {
    const d = darts[i];
    if (d) {
      dEls[i].innerText = d.label;
      sEls[i].innerText = d.score ? d.score : '';
      total += d.score;
    } else {
      dEls[i].innerText = 'â€”';
      sEls[i].innerText = '';
    }
  }
  totalEl.innerText = total;
}

// Grid clicks
document.querySelectorAll('.cell').forEach(cell => {
  cell.addEventListener('click', () => {
    const val = cell.innerText.trim();
    if (!val || cell.disabled) return;
    if (cell.id === 'backspace') {
      backspace();
      return;
    }
    const entry = makeEntry(val);
    if (entry) fillNext(entry);
  });
});

// Buttons
document.getElementById('calcBtn').onclick = calculate;
document.getElementById('clearBtn').onclick = clearTurn;
document.getElementById('amendBtn').onclick = amend;

// Theme toggle
const toggleBtn = document.getElementById('themeToggle');
toggleBtn.onclick = () => {
  const current = document.body.getAttribute('data-theme');
  document.body.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
};

// Init
document.body.setAttribute('data-theme', 'dark');
render();
</script>
</body>
</html>
